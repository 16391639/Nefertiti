<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ¬å‘¨ä¸¤äººè€æ”¾å¸¦é¥­è®¡åˆ’</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background-color: white;
            color: black;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        .control-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f5f5f5;
        }
        .leftover {
            background-color: #fff9e6;
            color: #e67e00;
            font-weight: bold;
        }
        button {
            padding: 6px 12px;
            background-color: #4a86e8;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #3a76d8;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .shopping-list {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }
        .shopping-category {
            flex: 1;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }
        .shopping-category h3 {
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .shopping-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        #regenAll {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>æœ¬å‘¨ä¸¤äººè€æ”¾å¸¦é¥­è®¡åˆ’ï¼ˆå‘¨ä¸€åˆâ†’å‘¨äº”æ™šï¼‰</h1>
    
    <div class="control-panel">
        <label>
            <input type="checkbox" id="hasBraised"> å†°ç®±å·²æœ‰å¤å‘³
        </label>
        <button id="regenAll">å…¨å±€æ¢ä¸€æ‰¹</button>
    </div>
    
    <table id="meal-plan">
        <thead>
            <tr>
                <th>æ˜ŸæœŸ</th>
                <th>é¤æ¬¡</th>
                <th>ä¸»èœ(è¤)</th>
                <th>å‰¯èœ(ç´ )</th>
                <th>æ“ä½œ</th>
                <th>å‰©èœå¸¦é¥­</th>
            </tr>
        </thead>
        <tbody>
            <!-- è¡¨æ ¼å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </tbody>
    </table>
    
    <div class="shopping-list">
        <div class="shopping-category">
            <h3>è‚‰ç±»è´­ç‰©æ¸…å•</h3>
            <div id="meat-list"></div>
        </div>
        <div class="shopping-category">
            <h3>è”¬èœè´­ç‰©æ¸…å•</h3>
            <div id="vegetable-list"></div>
        </div>
        <div class="shopping-category">
            <h3>è°ƒæ–™è´­ç‰©æ¸…å•</h3>
            <div id="seasoning-list"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // å®šä¹‰èœå“æ± 
            const meatDishes = [
                {name: "å’–å–±è‚‰æœ«", meat: "çŒªè‚‰ 0.3æ–¤", vegetable: "åœŸè±† 2ä¸ª", seasoning: "å’–å–±å— 1å— ç”ŸæŠ½ 1å‹º", tip: "å’–å–±æŠ—èŒï¼Œè‚‰æœ«æ˜“çƒ­"},
                {name: "ç•ªèŒ„ç‰›è…©", meat: "ç‰›è…© 0.5æ–¤", vegetable: "ç•ªèŒ„ 3ä¸ª", seasoning: "å…«è§’ 2ä¸ª é¦™å¶ 2ç‰‡ æ–™é…’ 1å‹º", tip: "ç•ªèŒ„é…¸æ€§èƒ½æŠ‘åˆ¶ç»†èŒ"},
                {name: "çº¢ä¸‰å‰", meat: "çŒªè‚‰ 0.3æ–¤", vegetable: "é’æ¤’ 2ä¸ª ç•ªèŒ„ 2ä¸ª", seasoning: "ç”ŸæŠ½ 1å‹º æ–™é…’ 1å‹º", tip: "è¾£æ¤’ç´ æŠ‘åˆ¶å¾®ç”Ÿç‰©"},
                {name: "çº¢çƒ§æ’éª¨", meat: "æ’éª¨ 0.6æ–¤", vegetable: "", seasoning: "è€æŠ½ 1å‹º å†°ç³– 10å…‹ å…«è§’ 2ä¸ª", tip: "çº¢çƒ§é«˜ç›é«˜ç³–è€å­˜æ”¾"},
                {name: "å’–å–±åœŸè±†é¸¡å—", meat: "é¸¡è…¿ 0.5æ–¤", vegetable: "åœŸè±† 2ä¸ª", seasoning: "å’–å–±å— 1å— æ¤°æµ† 50æ¯«å‡", tip: "å’–å–±å¤©ç„¶é˜²è…"},
                {name: "ä¸œå¡è‚‰æ–¹", meat: "äº”èŠ±è‚‰ 0.6æ–¤", vegetable: "", seasoning: "è€æŠ½ 1å‹º é»„é…’ 3å‹º å†°ç³– 15å…‹", tip: "é«˜è„‚é«˜ç›ä¸æ˜“å˜è´¨"},
                {name: "å¤é¸¡è…¿", meat: "é¸¡è…¿ 0.6æ–¤", vegetable: "", seasoning: "å¤æ–™åŒ… 1ä¸ª è€æŠ½ 1å‹º", tip: "å¤åˆ¶å·¥è‰ºå»¶é•¿ä¿é²œ"},
                {name: "é…±é¦™é¸¡ç¿…", meat: "é¸¡ç¿… 0.5æ–¤", vegetable: "", seasoning: "ç”œé¢é…± 2å‹º èœ‚èœœ 1å‹º", tip: "é…±æ–™é«˜ç›æŠ‘åˆ¶ç»†èŒ"},
                {name: "å¯ä¹é¸¡ç¿…", meat: "é¸¡ç¿… 0.5æ–¤", vegetable: "", seasoning: "å¯ä¹ 200æ¯«å‡ ç”ŸæŠ½ 1å‹º", tip: "ç¢³é…¸å’Œç³–æœ‰é˜²è…ä½œç”¨"},
                {name: "èœœæ±å‰çƒ§", meat: "æ¢…èŠ±è‚‰ 0.5æ–¤", vegetable: "", seasoning: "å‰çƒ§é…± 3å‹º èœ‚èœœ 1å‹º", tip: "èœœç³–å¤©ç„¶é˜²è…å‰‚"}
            ];
            
            const vegetableDishes = [
                {name: "å’–å–±åœŸè±†", meat: "", vegetable: "åœŸè±† 2ä¸ª", seasoning: "å’–å–±å— 1å— æ¤°æµ† 50æ¯«å‡", tip: "å’–å–±æŠ—èŒè€å­˜æ”¾"},
                {name: "çº¢çƒ§èåœ", meat: "", vegetable: "ç™½èåœ 1æ ¹", seasoning: "è€æŠ½ 1å‹º ç³– 5å…‹", tip: "èåœçƒ§åˆ¶åè€æ”¾"},
                {name: "å¤æµ·å¸¦ç»“", meat: "", vegetable: "æµ·å¸¦ç»“ 200å…‹", seasoning: "å¤æ± 200æ¯«å‡", tip: "å¤åˆ¶é£Ÿå“ä¸æ˜“å˜è´¨"},
                {name: "æ²¹ç„–èŒ„å­", meat: "", vegetable: "èŒ„å­ 2ä¸ª", seasoning: "ç”ŸæŠ½ 1å‹º ç³– 5å…‹", tip: "æ²¹å°éš”ç»ç©ºæ°”é˜²å˜è´¨"},
                {name: "é¦™è‡çƒ©è±†è…", meat: "", vegetable: "é¦™è‡ 5æœµ è±†è… 1å—", seasoning: "èšæ²¹ 1å‹º ç”ŸæŠ½ 1å‹º", tip: "è±†è…çƒ©åˆ¶åæ›´è€æ”¾"},
                {name: "è¥¿çº¢æŸ¿çƒ©èŠ±èœ", meat: "", vegetable: "èŠ±èœ 1ä¸ª ç•ªèŒ„ 1ä¸ª", seasoning: "ç•ªèŒ„é…± 1å‹º ç› 3å…‹", tip: "ç•ªèŒ„é…¸æ€§å»¶é•¿ä¿é²œ"},
                {name: "é…¸è±†è§’ç‚’æ¯›è±†", meat: "", vegetable: "é…¸è±†è§’ 100å…‹ æ¯›è±† 100å…‹", seasoning: "å¹²è¾£æ¤’ 3ä¸ª è’œ 2ç“£", tip: "å‘é…µé£Ÿå“å¤©ç„¶é˜²è…"},
                {name: "å¹²é”…åŒ…èœ", meat: "", vegetable: "åŒ…èœ åŠä¸ª", seasoning: "å¹²è¾£æ¤’ 5ä¸ª èŠ±æ¤’ 1å‹º", tip: "å¹²é”…è„±æ°´ä¸æ˜“å"},
                {name: "åœ°ä¸‰é²œ", meat: "", vegetable: "åœŸè±† 1ä¸ª èŒ„å­ 1ä¸ª é’æ¤’ 1ä¸ª", seasoning: "ç”ŸæŠ½ 1å‹º è€æŠ½ åŠå‹º", tip: "è¿‡æ²¹å¤„ç†å»¶é•¿ä¿é²œæœŸ"},
                {name: "çº¢çƒ§è±†è…", meat: "", vegetable: "è±†è… 1å—", seasoning: "è€æŠ½ 1å‹º ç³– 5å…‹", tip: "çº¢çƒ§åšæ³•è€å­˜æ”¾"}
            ];
            
            const braisedDishes = [
                {name: "å¤é¸¡è…¿", meat: "é¸¡è…¿ 0.6æ–¤", vegetable: "", seasoning: "å¤æ–™åŒ… 1ä¸ª è€æŠ½ 1å‹º", tip: "å¤åˆ¶å·¥è‰ºå»¶é•¿ä¿é²œ"},
                {name: "å¤æ°´é¸­ç¿…", meat: "é¸­ç¿… 0.5æ–¤", vegetable: "", seasoning: "å¤æ°´ 200æ¯«å‡", tip: "å¤æ°´æŠ—èŒé˜²å˜è´¨"},
                {name: "å¤ç‰›è‚‰", meat: "ç‰›è…±å­ 0.6æ–¤", vegetable: "", seasoning: "å¤æ–™åŒ… 1ä¸ª è€æŠ½ 1å‹º", tip: "ç‰›è‚‰å¤åˆ¶åéå¸¸è€æ”¾"},
                {name: "å¤æµ·å¸¦ç»“", meat: "", vegetable: "æµ·å¸¦ç»“ 200å…‹", seasoning: "å¤æ± 200æ¯«å‡", tip: "å¤åˆ¶é£Ÿå“ä¸æ˜“å˜è´¨"},
                {name: "å¤é¦™è‡", meat: "", vegetable: "å¹²é¦™è‡ 10æœµ", seasoning: "å¤æ± 200æ¯«å‡", tip: "é¦™è‡å¸å‘³è€å­˜æ”¾"},
                {name: "å¤è±†å¹²", meat: "", vegetable: "è±†å¹² 5å—", seasoning: "å¤æ± 200æ¯«å‡", tip: "è±†å¹²å¤åˆ¶åä¿è´¨æœŸé•¿"}
            ];
            
            // å½“å‰å‘¨è®¡åˆ’æ•°æ®
            let weeklyPlan = [];
            let usedDishes = new Set();
            
            // DOM å…ƒç´ 
            const planTable = document.getElementById('meal-plan');
            const tbody = planTable.querySelector('tbody');
            const meatList = document.getElementById('meat-list');
            const vegetableList = document.getElementById('vegetable-list');
            const seasoningList = document.getElementById('seasoning-list');
            const regenAllBtn = document.getElementById('regenAll');
            const hasBraisedCheckbox = document.getElementById('hasBraised');
            
            // åˆå§‹åŒ–
            function init() {
                generateWeeklyPlan();
                renderTable();
                updateShoppingList();
                
                // ç»‘å®šäº‹ä»¶
                regenAllBtn.addEventListener('click', function() {
                    generateWeeklyPlan();
                    renderTable();
                    updateShoppingList();
                });
                
                hasBraisedCheckbox.addEventListener('change', function() {
                    generateWeeklyPlan();
                    renderTable();
                    updateShoppingList();
                });
            }
            
            // ç”Ÿæˆå‘¨è®¡åˆ’
            function generateWeeklyPlan() {
                weeklyPlan = [];
                usedDishes.clear();
                
                const days = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”'];
                const meals = ['åˆé¤', 'æ™šé¤'];
                const hasBraised = hasBraisedCheckbox.checked;
                
                for (let i = 0; i < days.length; i++) {
                    for (let j = 0; j < meals.length; j++) {
                        const isDinner = meals[j] === 'æ™šé¤';
                        const isEarlyWeek = i < 3; // å‘¨ä¸€åˆ°å‘¨ä¸‰
                        
                        let meatDish, vegDish;
                        
                        // é€‰æ‹©ä¸»èœ(è¤)
                        if (isDinner && isEarlyWeek && hasBraised && braisedDishes.length > 0) {
                            meatDish = getRandomDish(braisedDishes, true);
                        } else {
                            meatDish = getRandomDish(meatDishes, false);
                        }
                        
                        // é€‰æ‹©å‰¯èœ(ç´ )
                        vegDish = getRandomDish(vegetableDishes, false);
                        
                        weeklyPlan.push({
                            day: days[i],
                            meal: meals[j],
                            meatDish: meatDish,
                            vegDish: vegDish,
                            isLeftover: false
                        });
                    }
                }
                
                // å¤„ç†å‰©èœé€»è¾‘
                for (let i = 0; i < weeklyPlan.length; i++) {
                    if (weeklyPlan[i].meal === 'æ™šé¤' && i < weeklyPlan.length - 1) {
                        weeklyPlan[i+1].isLeftover = true;
                        weeklyPlan[i+1].meatDish = weeklyPlan[i].meatDish;
                        weeklyPlan[i+1].vegDish = weeklyPlan[i].vegDish;
                        i++; // è·³è¿‡åˆé¤
                    }
                }
            }
            
            // ä»èœå“æ± ä¸­éšæœºé€‰æ‹©ä¸€é“èœ
            function getRandomDish(pool, isBraised) {
                if (pool.length === 0) {
                    return {name: "æš‚æ— èœå“", meat: "", vegetable: "", seasoning: "", tip: ""};
                }
                
                let availableDishes;
                if (isBraised) {
                    availableDishes = braisedDishes.filter(dish => !usedDishes.has(dish.name));
                } else {
                    availableDishes = pool.filter(dish => !usedDishes.has(dish.name));
                }
                
                if (availableDishes.length === 0) {
                    // å¦‚æœæ‰€æœ‰èœéƒ½å·²ä½¿ç”¨ï¼Œé‡ç½®å·²ç”¨åˆ—è¡¨
                    usedDishes.clear();
                    availableDishes = [...pool];
                }
                
                const randomIndex = Math.floor(Math.random() * availableDishes.length);
                const selectedDish = availableDishes[randomIndex];
                usedDishes.add(selectedDish.name);
                
                return selectedDish;
            }
            
            // æ¸²æŸ“è¡¨æ ¼
            function renderTable() {
                tbody.innerHTML = '';
                
                weeklyPlan.forEach((plan, index) => {
                    const row = document.createElement('tr');
                    
                    // æ˜ŸæœŸ
                    const dayCell = document.createElement('td');
                    dayCell.textContent = plan.day;
                    row.appendChild(dayCell);
                    
                    // é¤æ¬¡
                    const mealCell = document.createElement('td');
                    mealCell.textContent = plan.meal;
                    row.appendChild(mealCell);
                    
                    // ä¸»èœ(è¤)
                    const meatCell = document.createElement('td');
                    meatCell.innerHTML = `${plan.meatDish.name} <span style="color: #666; font-size: 0.9em;">(${plan.meatDish.tip})</span>`;
                    row.appendChild(meatCell);
                    
                    // å‰¯èœ(ç´ )
                    const vegCell = document.createElement('td');
                    vegCell.innerHTML = `${plan.vegDish.name} <span style="color: #666; font-size: 0.9em;">(${plan.vegDish.tip})</span>`;
                    row.appendChild(vegCell);
                    
                    // æ“ä½œ
                    const actionCell = document.createElement('td');
                    const changeBtn = document.createElement('button');
                    changeBtn.textContent = 'æ¢è¿™ä¸€é¡¿';
                    changeBtn.addEventListener('click', function() {
                        changeMeal(index);
                    });
                    
                    if (plan.isLeftover) {
                        changeBtn.disabled = true;
                        changeBtn.title = "è¯·å…ˆæ›´æ¢å‰æ™šæ™šé¤ï¼Œå¦åˆ™æ— æ³•æ›´æ¢å‰©èœ";
                    }
                    
                    actionCell.appendChild(changeBtn);
                    row.appendChild(actionCell);
                    
                    // å‰©èœå¸¦é¥­
                    const leftoverCell = document.createElement('td');
                    if (plan.isLeftover) {
                        leftoverCell.textContent = 'ğŸ± å‰©èœå¸¦é¥­';
                        leftoverCell.classList.add('leftover');
                    }
                    row.appendChild(leftoverCell);
                    
                    tbody.appendChild(row);
                });
            }
            
            // æ›´æ¢å•é¤
            function changeMeal(index) {
                const plan = weeklyPlan[index];
                
                // å¦‚æœæ˜¯å‰©èœï¼Œä¸èƒ½ç›´æ¥æ›´æ¢
                if (plan.isLeftover) {
                    alert('è¯·å…ˆæ›´æ¢å‰æ™šæ™šé¤ï¼Œå¦åˆ™æ— æ³•æ›´æ¢å‰©èœ');
                    return;
                }
                
                // å¦‚æœæ˜¯æ™šé¤ï¼Œå…ˆæ¸…ç©ºæ¬¡æ—¥åˆé¤çš„å‰©èœæ ‡è®°
                if (plan.meal === 'æ™šé¤' && index < weeklyPlan.length - 1) {
                    weeklyPlan[index + 1].isLeftover = false;
                }
                
                // è·å–æ–°èœå“
                const isDinner = plan.meal === 'æ™šé¤';
                const isEarlyWeek = index < 6; // å‰3å¤©(0-5ç´¢å¼•)
                const hasBraised = hasBraisedCheckbox.checked;
                
                // æ›´æ¢ä¸»èœ
                if (isDinner && isEarlyWeek && hasBraised && braisedDishes.length > 0) {
                    plan.meatDish = getRandomDish(braisedDishes, true);
                } else {
                    plan.meatDish = getRandomDish(meatDishes, false);
                }
                
                // æ›´æ¢å‰¯èœ
                plan.vegDish = getRandomDish(vegetableDishes, false);
                
                // å¦‚æœæ˜¯æ™šé¤ä¸”ä»½æ•°â‰¥2ï¼Œè®¾ç½®æ¬¡æ—¥åˆé¤ä¸ºå‰©èœ
                if (plan.meal === 'æ™šé¤' && index < weeklyPlan.length - 1) {
                    weeklyPlan[index + 1].isLeftover = true;
                    weeklyPlan[index + 1].meatDish = plan.meatDish;
                    weeklyPlan[index + 1].vegDish = plan.vegDish;
                }
                
                // æ›´æ–°ç•Œé¢
                renderTable();
                updateShoppingList();
            }
            
            // æ›´æ–°è´­ç‰©æ¸…å•
            function updateShoppingList() {
                const meatItems = {};
                const vegetableItems = {};
                const seasoningItems = {};
                
                // æ”¶é›†æ‰€æœ‰é£Ÿæ
                weeklyPlan.forEach(plan => {
                    if (!plan.isLeftover) {
                        parseIngredients(plan.meatDish.meat, meatItems);
                        parseIngredients(plan.vegDish.meat, meatItems);
                        
                        parseIngredients(plan.meatDish.vegetable, vegetableItems);
                        parseIngredients(plan.vegDish.vegetable, vegetableItems);
                        
                        parseIngredients(plan.meatDish.seasoning, seasoningItems);
                        parseIngredients(plan.vegDish.seasoning, seasoningItems);
                    }
                });
                
                // æ¸²æŸ“è´­ç‰©æ¸…å•
                renderShoppingList(meatList, meatItems, 'æ–¤', true);
                renderShoppingList(vegetableList, vegetableItems, '', false);
                renderShoppingList(seasoningList, seasoningItems, '', false);
            }
            
            // è§£æé£Ÿæå­—ç¬¦ä¸²
            function parseIngredients(ingredientStr, itemsDict) {
                if (!ingredientStr) return;
                
                const ingredients = ingredientStr.split(' ');
                for (let i = 0; i < ingredients.length; i += 2) {
                    if (i + 1 >= ingredients.length) break;
                    
                    const name = ingredients[i];
                    const amountWithUnit = ingredients[i + 1];
                    
                    // åˆ†ç¦»æ•°å€¼å’Œå•ä½
                    const amount = parseFloat(amountWithUnit);
                    const unit = amountWithUnit.replace(/[0-9.]/g, '');
                    
                    if (!itemsDict[name]) {
                        itemsDict[name] = { amount: 0, unit: unit };
                    }
                    
                    // ç´¯åŠ æ•°é‡ï¼ˆä¹˜ä»¥2æ˜¯å› ä¸ºä¸¤äººä»½ï¼‰
                    itemsDict[name].amount += amount * 2;
                }
            }
            
            // æ¸²æŸ“è´­ç‰©æ¸…å•
            function renderShoppingList(container, items, defaultUnit, isDecimal) {
                container.innerHTML = '';
                
                if (Object.keys(items).length === 0) {
                    container.innerHTML = '<div class="shopping-item">â€”â€”</div>';
                    return;
                }
                
                for (const [name, data] of Object.entries(items)) {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'shopping-item';
                    
                    const amount = isDecimal ? data.amount.toFixed(1) : Math.round(data.amount);
                    const unit = data.unit || defaultUnit;
                    
                    itemDiv.innerHTML = `
                        <span>${name}</span>
                        <span>${amount}${unit}</span>
                    `;
                    
                    container.appendChild(itemDiv);
                }
            }
            
            // å¯åŠ¨åˆå§‹åŒ–
            init();
        });
    </script>
</body>
</html>